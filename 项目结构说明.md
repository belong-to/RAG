# RAG实战项目结构说明

## 项目概述

本项目是一个基于RAG（检索增强生成）技术的文档检索系统，包含用户认证、文档处理和向量检索等功能。项目采用模块化设计，使用MySQL数据库存储用户信息，使用向量数据库存储文档向量。系统支持多种文件格式的导入、处理和检索，为用户提供基于大模型的智能问答服务。


### 根目录

- **login_app.py**: 基础版登录应用，提供用户注册、登录和邮箱验证功能
- **add_admins.py**: 添加管理员用户到admins表的工具脚本
- **check_db_structure.py**: 检查数据库结构的工具脚本，验证表和字段是否正确
- **project_architecture.svg**: 项目架构图

### modules目录 - 核心功能模块（按功能分类）

#### auth/ - 认证相关模块
- **auth.py**: JWT认证模块，提供令牌生成、验证和刷新功能
- **email_verification.py**: 邮箱验证模块，提供验证码生成和邮件发送功能
- **email_verification_enhanced.py**: 增强版邮箱验证模块，提供更完善的验证流程
- **user_manager.py**: 用户管理模块，提供用户注册、登录和管理功能
- **user_manager_enhanced.py**: 增强版用户管理模块，使用连接池和更好的错误处理

#### document/ - 文档处理相关模块
- **document_processor.py**: 文档处理模块，负责文档的解析和预处理
- **document_processor_async.py**: 异步文档处理模块，提高大文件处理效率
- **file_manager.py**: 文件管理模块，负责上传文件的保存、获取和清理

#### retrieval/ - 检索相关模块
- **vector_store.py**: 向量存储模块，提供文档向量化和检索功能
- **vector_store_enhanced.py**: 增强版向量存储模块，支持更多向量数据库和优化检索算法
- **enhanced_retrieval.py**: 增强检索模块，提供高级检索策略
- **search_engine.py**: 搜索引擎模块，整合检索功能

#### chat/ - 聊天相关模块
- **chat_manager.py**: 聊天管理模块，处理用户与AI的对话交互
- **model_interface.py**: 模型接口模块，统一大模型调用接口

#### db/ - 数据库相关模块
- **db_pool.py**: 数据库连接池模块，提供高效的数据库连接管理

### pages目录 - 前端页面

#### admin/ - 管理员相关页面
- **admin_dashboard.py**: 管理员控制台页面，提供用户管理功能

#### app/ - 主应用页面
- **web_app.py**: 主要Web应用页面，提供RAG文档检索功能
- **web_app_enhanced.py**: 增强版Web应用页面，提供更多功能

#### static/ - 静态资源
- **css/**
  - **login_style.css**: 登录页面样式
  - **style.css**: 通用样式，定义整个应用的视觉风格
  - **style_enhanced.css**: 增强版样式，提供更现代的视觉效果

### uploads目录 - 文档存储

- 用于存储用户上传的文档文件（PDF、DOCX、TXT等）
- 包含.gitignore文件，用于版本控制时忽略上传的文档
- 系统支持的文档类型：PDF、DOCX、TXT、DOC

### config目录 - 配置文件

- **db_config.py**: 数据库配置
- **model_config.py**: 模型配置
- **app_config.py**: 应用配置

## 数据库结构

### 数据库: RAG

#### 表: users
- id: 用户ID (主键)
- username: 用户名 (唯一)
- password: 密码 (SHA256加密)
- email: 邮箱 (唯一)
- email_verified: 邮箱验证状态
- role: 用户角色 (默认为'user')
- created_at: 创建时间

#### 表: admins
- id: 管理员ID (主键)
- username: 用户名 (唯一)
- password: 密码 (SHA256加密)
- email: 邮箱 (唯一)
- role: 角色 (默认为'admin')
- created_at: 创建时间

#### 表: verification_codes
- id: 验证码ID (主键)
- email: 邮箱
- code: 验证码
- created_at: 创建时间
- expires_at: 过期时间
- used: 使用状态

## 功能模块说明

### 用户认证系统
- 基于JWT的认证机制，保障系统安全
- 邮箱验证功能，确保用户身份真实性
- 密码加密存储，保护用户信息安全
- 用户角色管理，区分普通用户和管理员权限
- 连接池技术，提高数据库访问效率

### 文件管理系统
- 支持多种文件格式上传（PDF、DOCX、TXT、DOC）
- 文件存储与管理，包括保存、获取和清理功能
- 文件类型验证，确保系统安全
- 异常处理机制，提高系统稳定性

### RAG文档检索系统
- 支持PDF、DOCX、TXT文件导入
- 文档切分和向量化，优化检索效果
- 基于向量相似度的文档检索
- 多种大模型和Embedding模型支持
- 文档重排序技术，提高回答相关性
- 多查询检索策略，增强检索效果

### 管理员控制台
- 用户管理，包括用户信息查看、编辑和删除
- 系统监控，实时了解系统运行状态
- 权限管理，控制不同角色的访问权限

## 优化说明

本次项目结构优化主要从以下几个方面进行：

1. **功能模块化**：将相关功能的模块组织到专门的子目录中，如认证相关、文档处理相关、检索相关等。

2. **前端资源整理**：将CSS等静态资源文件移至static目录，便于管理和引用。

3. **配置集中化**：新增config目录，集中管理各类配置信息。

4. **管理界面分离**：将管理员相关页面独立到admin目录，与普通用户界面分开管理。

5. **目录命名规范化**：使用小写字母和下划线命名目录，保持一致性。

通过以上优化，项目结构更加清晰，各模块之间的关系更加明确，便于开发人员理解和维护。同时，这种结构也为未来的功能扩展提供了良好的基础。